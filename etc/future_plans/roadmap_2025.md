# NanaSQLite 将来計画ロードマップと優先順位 (2025年12月版)

`etc/future_plans` にある各種提案を整理し、開発の優先順位と実装計画をまとめたものです。

## 概要

NanaSQLiteを「シンプルで堅牢なSQLiteラッパー」から、「高機能かつ安全なデータ管理ライブラリ」へと進化させるためのステップを3つのフェーズに分けました。

## 優先順位の考え方

1.  **最優先 (Security & Stability)**: 脆弱性の排除、リソースリークの防止、データの整合性。
2.  **中優先 (Usability & Documentation)**: 開発体験の向上、パフォーマンスの最適化、ドキュメントの整備。
3.  **低優先 (Advanced Features)**: 特定のユースケース向けの高機能化（ORM、FTCなど）。

---

## フェーズ 1: セキュリティ強化と基盤整備 (v1.2.0 目標)

最も重要かつ緊急性の高い、セキュリティと基本的な利便性の向上に焦点を当てます。

### 1.1 SQLインジェクション対策の徹底
- `_validate_column_expression()` の導入により、複雑な列名やAS句、関数の使用を安全に行えるようにします。
- 許可されるSQL関数のホワイトリスト化。

### 1.2 ReDoS（正規表現DoS）対策
- `order_by` や `group_by` で使用される正規表現の整理。
- 入力文字列長（`MAX_CLAUSE_LENGTH`）の制限。

### 1.3 `batch_get()` の実装
- 複数のキーを1回のクエリで取得可能にし、N+1問題を解決します。

### 1.4 ドキュメントの自動生成 (Sphinx)
- ReadTheDocs等と連携し、公式のAPIリファレンスをオンラインで公開できる体制を整えます。

### 1.5 接続状態の厳格なチェック
- `table()` で作成したサブインスタンスが、親の `close()` 後に誤って使用されるのを完全に防ぐ機構を導入します。

---

## フェーズ 2: 高機能化と最適化 (v1.3.0 目標)

アプリケーションの規模が大きくなった際の安定性と、開発のしやすさを向上させます。

### 2.1 高度なキャッシュ戦略 (LRU Cache)
- メモリ使用量の上限を設定し、古いキャッシュを自動削除するLRU（Least Recently Used）方式を導入します。

### 2.2 タイムアウト・ロック機構の改善
- デッドロックを防止するための、タイムアウト付きロック取得機能を導入します。

### 2.3 バリデーション機能の基盤
- データ挿入、更新時に独自のバリデーターを実行できる仕組みを導入します。

### 2.4 自動バックアップ
- データベースの簡易バックアップ・リストア機能を提供します。

---

## フェーズ 3: 利便性の極大化 (v1.4.0 以降)

本格的なアプリケーション開発において、生産性を高めるための機能を追加します。

### 3.1 クエリビルダー (Query Builder)
- SQLを直接書かずに、Pythonのメソッドチェーンで複雑なクエリを生成できる機能。

### 3.2 ORM風モデル定義
- Pydantic以外の独自の軽量モデルクラスのサポートを強化します。

### 3.3 インデックス自動最適化
- クエリ履歴を分析し、最適なインデックスの作成を提案する機能。
